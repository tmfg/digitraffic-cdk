#!/bin/sh
# Called by "git commit" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message if
# it wants to stop the commit.

set -e  # Exit immediately if any command fails

# Reorder changed package.json contents add reformatted files to staging to be committed
echo "Sort package.jsons..."
# Ensure Rush and its autoinstaller are available, then format package.json files and stage any changes
node common/scripts/install-run-rush.js format:package-json
# -r prevents xargs from running if no input
git diff --name-only | grep 'package.json$' | xargs -r git add
echo "Sort package.jsons done."

echo "Running Biome linting and formatting checks on staged files..."
# Ensure Rush and its autoinstaller are available, then lint staged files and stage any fixes
node common/scripts/install-run-rush.js format:fix-staged
# Re-stage any previously staged files
git update-index --again
echo "Biome linting and formatting checks done."

# Check package dependencies
echo "Running check package dependencies..."
node common/scripts/check-dependencies.mjs
echo "Running check package dependencies done."
