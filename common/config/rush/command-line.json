/**
 * This configuration file defines custom commands for the "rush" command-line.
 * More documentation is available on the Rush website: https://rushjs.io
 */
{
  "$schema": "https://developer.microsoft.com/json-schemas/rush/v5/command-line.schema.json",

  /**
   * Custom "commands" introduce new verbs for the command-line.  To see the help for these
   * example commands, try "rush --help", "rush my-bulk-command --help", or
   * "rush my-global-command --help".
   */
  "commands": [
    {
      "name": "run:format-package-json",
      "commandKind": "global",
      "summary": "Sorts all package.json files using sort-package-json",
      "shellCommand": "find . -name package.json \\\n\
        -not -path '*/node_modules/*' \\\n\
        -not -path '*/digitraffic-common/*' \\\n\
        -not -path '*/dist/*' \\\n\
        -not -path '*/temp/*' \\\n\
        -not -path '*/build/*' \\\n\
        -not -path '*/cdk.out/*' \\\n\
        | xargs npx --yes sort-package-json"
    },
    {
      "name": "run:format",
      "commandKind": "global",
      "summary": "Formats all projet files",
      "shellCommand": "npx --yes deno fmt"
    },
    {
      "name": "build",
      "commandKind": "bulk",
      "summary": "Run build step for all projects in the monorepo.",
      "safeForSimultaneousRushProcesses": false,
      "enableParallelism": false,
      "allowWarningsInSuccessfulBuild": true
    },
    {
      "name": "test",
      "commandKind": "bulk",
      "summary": "Run test for all projects in the monorepo.",
      "safeForSimultaneousRushProcesses": false,
      "enableParallelism": false
    },
    {
      "name": "repo:check-dependencies",
      "commandKind": "global",
      "summary": "Checks if dependencies are declared correctly",
      "shellCommand": "node common/scripts/check-dependencies.mjs"
    },
    {
      "name": "repo:unify-deps",
      "commandKind": "global",
      "summary": "Checks if dependencies are declared correctly",
      // Using pnpm to install zx here to ensure that zx is found
      "shellCommand": "pnpm install zx && npx zx common/scripts/unify-deps.mjs"
    },
    {
      "name": "ci:eslint-report",
      "commandKind": "bulk",
      "summary": "Used by the Github Actions to create eslint report.",
      "safeForSimultaneousRushProcesses": true,
      "enableParallelism": true
    },
    {
      "name": "common-subtree",
      "commandKind": "global",
      "summary": "Pull common subtree changes from some branch",
      "safeForSimultaneousRushProcesses": false,
      "shellCommand": "bash common/scripts/git-subtree-helper.sh"
    }
  ],
  "parameters": [
    {
      "parameterKind": "choice",
      "longName": "--cmd",
      "shortName": "-c",
      "description": "which command to do",
      "required": true,
      "associatedCommands": ["common-subtree"],
      "alternatives": [
        {
          "name": "pull",
          "description": "pull changes to common subtree"
        },
        {
          "name": "push",
          "description": "push changes to common subtree"
        },
        {
          "name": "diff",
          "description": "diff against some branch in common"
        },
        {
          "name": "subtree-add",
          "description": "Add common as subtree"
        }
      ]
    },
    {
      "parameterKind": "string",
      "longName": "--refspec",
      "shortName": "-r",
      "description": "git refspec for what to pull, such as master or name of a tag",
      "argumentName": "BRANCH_OR_TAG",
      "required": true,
      "associatedCommands": ["common-subtree"]
    }
  ]
}
