[
  {
    "name": "TST Ais metadata sent < 80(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 80
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Ais metadata sent < 80(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Ais metadata sent < 80(Runbook M2) should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Ais metadata sent > 80(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 80,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Ais metadata sent > 80(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Ais metadata sent > 80(Runbook M2) should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Ais positions sent < 1000(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 1000
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Ais positions sent < 1000(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Ais positions sent < 1000(Runbook M2) should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Ais positions sent > 1000(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 1000,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Ais positions sent > 1000(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Ais positions sent > 1000(Runbook M2) should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "marine-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 500 && ctx.results[0].hits.total.value <= 20000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine Daemon active should be between 500 and 20000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started MarineApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/f173baab4efd7231874224afc9aa55e2?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cc396f2ec7eea8c5e4f69ac38f80e1d7?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/384031b2f74b7705d507adbae7d1a1ba?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Ais metadata sent < 80(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 80
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Ais metadata sent < 80(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Ais metadata sent < 80(Runbook M2) should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Ais metadata sent > 80(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 80,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Ais metadata sent > 80(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Ais metadata sent > 80(Runbook M2) should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Ais positions sent < 1000(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 1000
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Ais positions sent < 1000(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Ais positions sent < 1000(Runbook M2) should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Ais positions sent > 1000(Runbook M2)",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 1000,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Ais positions sent > 1000(Runbook M2)",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Ais positions sent > 1000(Runbook M2) should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "marine-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 500 && ctx.results[0].hits.total.value <= 20000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine Daemon active should be between 500 and 20000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started MarineApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/c81b89dad4a270016a2c2d1f83032b0f?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/2d0da1cb2bd198172ed59a78a681f775?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/c9d31a20716d87ffe2ac5f83e6a685dc?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road Web connections pending",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.pending.max"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 10,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road Web connections pending",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 3)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road Web connections pending should be between 0 and 3, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road Daemon connections pending",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.pending.max"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 10,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road Daemon connections pending",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road Daemon connections pending {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road Web connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road Web connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road Web connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road Daemon connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road Daemon connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road Daemon connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 10 && ctx.results[0].hits.total.value <= 22000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road Daemon active should be between 10 and 22000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road Web active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road Web active",
        "condition": "!(ctx.results[0].hits.total.value >= 3 && ctx.results[0].hits.total.value <= 30000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road Web active should be between 3 and 30000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started RoadApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/f7c8e5a146396c0884557f0f0f3619b9?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/232c398100f80af0d7e3679d56386970?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/5cccccb3cc256ae9776f3919a64ee68a?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road Web connections pending",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.pending.max"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 170,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road Web connections pending",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 3)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road Web connections pending should be between 0 and 3, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road Daemon connections pending",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.pending.max"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 10,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road Daemon connections pending",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road Daemon connections pending {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road Web connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road Web connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road Web connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road Daemon connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road Daemon connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road Daemon connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 10 && ctx.results[0].hits.total.value <= 22000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road Daemon active should be between 10 and 22000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road Web active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road Web active",
        "condition": "!(ctx.results[0].hits.total.value >= 100 && ctx.results[0].hits.total.value <= 30000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road Web active should be between 100 and 30000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started RoadApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/bcb236b6012e73c95e7308d3f2e7ea04?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/edb80b772a0aff5732f2f8fd173bfd6f?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/0f456de30f2ba7b15edfc5b855d3cae7?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Afir active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Afir active",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 50)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Afir active should be between 0 and 50, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Afir lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Afir lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Afir lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/7fd7a861a44eed72e9428c23b18af4f7?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Afir lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Afir lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Afir lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Afir lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Afir lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Afir lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/25328a194d1be48a2bc0d69de2b30dbc?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Afir active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Afir active",
        "condition": "!(ctx.results[0].hits.total.value >= 200 && ctx.results[0].hits.total.value <= 15000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Afir active should be between 200 and 15000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Afir lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Afir lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Afir lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/01a085906b0c577b555d29fe296cc611?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Afir lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Afir lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Afir lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Afir lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Afir lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Afir lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/25328a194d1be48a2bc0d69de2b30dbc?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail Avoindata-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail Avoindata-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 5000 && ctx.results[0].hits.total.value <= 35000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail Avoindata-updater active should be between 5000 and 35000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail History-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "history-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail History-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 50 && ctx.results[0].hits.total.value <= 200)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail History-updater active should be between 50 and 200, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST AvoindataUpdater reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started DatabaseUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST AvoindataUpdater reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST AvoindataUpdater reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Etj2-Api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started Etj2APIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Etj2-Api reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Etj2-Api reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Infra-api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started InfraAPIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Infra-api reboots",
        "condition": "ctx.results[0].hits.total.value > 6",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Infra-api reboots {{ctx.results.0.hits.total.value}} should not be more than 6",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST TrainHistoryBackendApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryBackendApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST TrainHistoryBackendApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST TrainHistoryBackendApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST TrainHistoryUpdaterApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST TrainHistoryUpdaterApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST TrainHistoryUpdaterApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cea150b91a7ace1e536d55a50210ebed?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail graphql errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail graphql errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail graphql errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cea150b91a7ace1e536d55a50210ebed?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail train-history errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "train-history"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail train-history errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail train-history errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cea150b91a7ace1e536d55a50210ebed?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail infra-api OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "infra-api"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail infra-api OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail infra-api OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail graphql OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail graphql OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail graphql OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail train-history OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail train-history OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail train-history OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/f64be232c96cd88b3fe8f3d2e59f6198?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/266c9199b73fc3bf9b866e9ddb90780d?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail Avoindata-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail Avoindata-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 5000 && ctx.results[0].hits.total.value <= 35000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail Avoindata-updater active should be between 5000 and 35000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail History-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "history-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail History-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 50 && ctx.results[0].hits.total.value <= 200)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail History-updater active should be between 50 and 200, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD AvoindataUpdater reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started DatabaseUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD AvoindataUpdater reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD AvoindataUpdater reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Etj2-Api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started Etj2APIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Etj2-Api reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Etj2-Api reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Infra-api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started InfraAPIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Infra-api reboots",
        "condition": "ctx.results[0].hits.total.value > 6",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Infra-api reboots {{ctx.results.0.hits.total.value}} should not be more than 6",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD TrainHistoryBackendApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryBackendApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD TrainHistoryBackendApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD TrainHistoryBackendApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD TrainHistoryUpdaterApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD TrainHistoryUpdaterApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD TrainHistoryUpdaterApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/b04e3ee091dde8e82bc72bb99fac5379?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail graphql errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail graphql errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail graphql errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/b04e3ee091dde8e82bc72bb99fac5379?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail train-history errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "train-history"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail train-history errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail train-history errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/b04e3ee091dde8e82bc72bb99fac5379?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail infra-api OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "infra-api"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail infra-api OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail infra-api OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail graphql OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail graphql OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail graphql OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail train-history OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail train-history OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail train-history OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/4b61aad16aa801966eed2fec72477fa6?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/443db667f3890e1332a069c72aac0df2?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Road Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "subdomain": {
                  "query": "tie"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Road Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 10000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Road Cloudfront active should be between 0 and 10000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Marine Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "subdomain": {
                  "query": "meri"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Marine Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 10000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Marine Cloudfront active should be between 0 and 10000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST Rail Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "subdomain": {
                  "query": "rata"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST Rail Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 10000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST Rail Cloudfront active should be between 0 and 10000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Road Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "subdomain": {
                  "query": "tie"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Road Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 100 && ctx.results[0].hits.total.value <= 75000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Road Cloudfront active should be between 100 and 75000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Marine Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "subdomain": {
                  "query": "meri"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Marine Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 100 && ctx.results[0].hits.total.value <= 30000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Marine Cloudfront active should be between 100 and 30000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD Rail Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "subdomain": {
                  "query": "rata"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD Rail Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 100 && ctx.results[0].hits.total.value <= 75000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD Rail Cloudfront active should be between 100 and 75000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST RUNBOOK-L1 Liipi user's organization not found",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "parking"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "Could not find an operator"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST RUNBOOK-L1 Liipi user's organization not found",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST RUNBOOK-L1 Liipi user's organization not found {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD RUNBOOK-L1 Liipi user's organization not found",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "parking"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "Could not find an operator"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD RUNBOOK-L1 Liipi user's organization not found",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD RUNBOOK-L1 Liipi user's organization not found {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TST TIS errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-tis-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "TST TIS errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TST TIS errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PRD TIS errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-tis-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "triggers": [
      {
        "name": "PRD TIS errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PRD TIS errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  }
]
