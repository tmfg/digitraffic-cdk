[
  {
    "name": "MARINE TST RUNBOOK-M2 - Ais metadata sent < 80",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 80
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST RUNBOOK-M2 - Ais metadata sent < 80",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST RUNBOOK-M2 - Ais metadata sent < 80 should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST RUNBOOK-M2 - Ais metadata sent > 80",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 80,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST RUNBOOK-M2 - Ais metadata sent > 80",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST RUNBOOK-M2 - Ais metadata sent > 80 should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST RUNBOOK-M2 - Ais positions sent < 1000",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 1000
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST RUNBOOK-M2 - Ais positions sent < 1000",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST RUNBOOK-M2 - Ais positions sent < 1000 should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST RUNBOOK-M2 - Ais positions sent > 1000",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 1000,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST RUNBOOK-M2 - Ais positions sent > 1000",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST RUNBOOK-M2 - Ais positions sent > 1000 should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "marine-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 500 && ctx.results[0].hits.total.value <= 20000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST Daemon active should be between 500 and 20000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST RUNBOOK-Y5 - Reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started MarineApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST RUNBOOK-Y5 - Reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST RUNBOOK-Y5 - Reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST Java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST Java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST Java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/f173baab4efd7231874224afc9aa55e2?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST Java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST Java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST Java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "Marinecam-UpdateImages"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cc396f2ec7eea8c5e4f69ac38f80e1d7?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE TST Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE TST Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: MARINE TST Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/384031b2f74b7705d507adbae7d1a1ba?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD RUNBOOK-M2 - Ais metadata sent < 80",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 80
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD RUNBOOK-M2 - Ais metadata sent < 80",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD RUNBOOK-M2 - Ais metadata sent < 80 should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD RUNBOOK-M2 - Ais metadata sent > 80",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "METADATA"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 80,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD RUNBOOK-M2 - Ais metadata sent > 80",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD RUNBOOK-M2 - Ais metadata sent > 80 should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD RUNBOOK-M2 - Ais positions sent < 1000",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": null,
                  "to": 1000
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD RUNBOOK-M2 - Ais positions sent < 1000",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 5)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD RUNBOOK-M2 - Ais positions sent < 1000 should be between 0 and 5, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD RUNBOOK-M2 - Ais positions sent > 1000",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "logger_name": {
                  "query": "fi.livi.digitraffic.meri.controller.reader.VesselLoggingListener"
                }
              }
            },
            {
              "match_phrase": {
                "loggerType": {
                  "query": "SEND"
                }
              }
            },
            {
              "match_phrase": {
                "messageType": {
                  "query": "POSITION"
                }
              }
            },
            {
              "range": {
                "messages": {
                  "from": 1000,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD RUNBOOK-M2 - Ais positions sent > 1000",
        "condition": "!(ctx.results[0].hits.total.value >= 6 && ctx.results[0].hits.total.value <= 20)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD RUNBOOK-M2 - Ais positions sent > 1000 should be between 6 and 20, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "marine-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 500 && ctx.results[0].hits.total.value <= 20000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD Daemon active should be between 500 and 20000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD RUNBOOK-Y5 - Reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started MarineApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD RUNBOOK-Y5 - Reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD RUNBOOK-Y5 - Reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD Java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD Java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD Java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/c81b89dad4a270016a2c2d1f83032b0f?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD Java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD Java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD Java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "Marinecam-UpdateImages"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/2d0da1cb2bd198172ed59a78a681f775?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "MARINE PRD Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "marine"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "MARINE PRD Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: MARINE PRD Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/c9d31a20716d87ffe2ac5f83e6a685dc?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Daemon connections pending",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.pending.max"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 10,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Daemon connections pending",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Daemon connections pending {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Web connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Web connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Web connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Daemon connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Daemon connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Daemon connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 10 && ctx.results[0].hits.total.value <= 22000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Daemon active should be between 10 and 22000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Web active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Web active",
        "condition": "!(ctx.results[0].hits.total.value >= 3 && ctx.results[0].hits.total.value <= 30000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Web active should be between 3 and 30000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST RUNBOOK-Y5 - Reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started RoadApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST RUNBOOK-Y5 - Reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST RUNBOOK-Y5 - Reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/f7c8e5a146396c0884557f0f0f3619b9?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/232c398100f80af0d7e3679d56386970?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD TST Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD TST Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: ROAD TST Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/5cccccb3cc256ae9776f3919a64ee68a?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Daemon connections pending",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.pending.max"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 10,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Daemon connections pending",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Daemon connections pending {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Web connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Web connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Web connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Daemon connections timeout",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            },
            {
              "match_phrase": {
                "meterName": {
                  "query": "hikaricp.connections.timeout.period"
                }
              }
            },
            {
              "range": {
                "statisticValue": {
                  "from": 1,
                  "to": null
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Daemon connections timeout",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Daemon connections timeout {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Daemon active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-daemon"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Daemon active",
        "condition": "!(ctx.results[0].hits.total.value >= 10 && ctx.results[0].hits.total.value <= 22000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Daemon active should be between 10 and 22000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Web active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "app": {
                  "query": "road-web"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Web active",
        "condition": "!(ctx.results[0].hits.total.value >= 100 && ctx.results[0].hits.total.value <= 30000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Web active should be between 100 and 30000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD RUNBOOK-Y5 - Reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started RoadApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD RUNBOOK-Y5 - Reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD RUNBOOK-Y5 - Reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Java errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Java errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Java errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/bcb236b6012e73c95e7308d3f2e7ea04?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Java OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Java OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Java OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/edb80b772a0aff5732f2f8fd173bfd6f?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "ROAD PRD Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "road"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "ROAD PRD Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: ROAD PRD Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/0f456de30f2ba7b15edfc5b855d3cae7?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR TST Active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR TST Active",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 50)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: AFIR TST Active should be between 0 and 50, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR TST Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR TST Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: AFIR TST Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/7fd7a861a44eed72e9428c23b18af4f7?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR TST Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR TST Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: AFIR TST Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR TST Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR TST Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: AFIR TST Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/25328a194d1be48a2bc0d69de2b30dbc?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR PRD Active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR PRD Active",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 15000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: AFIR PRD Active should be between 0 and 15000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR PRD Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR PRD Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: AFIR PRD Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/01a085906b0c577b555d29fe296cc611?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR PRD Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR PRD Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: AFIR PRD Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "AFIR PRD Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-afir-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "afir"
                }
              }
            },
            {
              "match_phrase": {
                "lambdaName": {
                  "query": "*"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "AFIR PRD Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: AFIR PRD Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/25328a194d1be48a2bc0d69de2b30dbc?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Avoindata-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Avoindata-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 5000 && ctx.results[0].hits.total.value <= 150000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Avoindata-updater active should be between 5000 and 150000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST History-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "history-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST History-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 50 && ctx.results[0].hits.total.value <= 500)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST History-updater active should be between 50 and 500, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST RUNBOOK-Y5 - AvoindataUpdater reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started DatabaseUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST RUNBOOK-Y5 - AvoindataUpdater reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST RUNBOOK-Y5 - AvoindataUpdater reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST RUNBOOK-Y5 - AvoindataUpdater reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started ServerApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST RUNBOOK-Y5 - AvoindataUpdater reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST RUNBOOK-Y5 - AvoindataUpdater reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST RUNBOOK-Y5 - Etj2-Api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started Etj2APIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST RUNBOOK-Y5 - Etj2-Api reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST RUNBOOK-Y5 - Etj2-Api reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST RUNBOOK-Y5 - Infra-api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started InfraAPIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST RUNBOOK-Y5 - Infra-api reboots",
        "condition": "ctx.results[0].hits.total.value > 6",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST RUNBOOK-Y5 - Infra-api reboots {{ctx.results.0.hits.total.value}} should not be more than 6",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST RUNBOOK-Y5 - TrainHistoryBackendApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryBackendApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST RUNBOOK-Y5 - TrainHistoryBackendApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST RUNBOOK-Y5 - TrainHistoryBackendApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST RUNBOOK-Y5 - TrainHistoryUpdaterApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST RUNBOOK-Y5 - TrainHistoryUpdaterApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST RUNBOOK-Y5 - TrainHistoryUpdaterApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST RUNBOOK-R4 - Illegal mix of collations",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "multi_match": {
                "query": "mix of collations",
                "fields": [
                  "stack_trace",
                  "dump_log"
                ],
                "type": "phrase"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST RUNBOOK-R4 - Illegal mix of collations",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST RUNBOOK-R4 - Illegal mix of collations {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Avoindata Errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Avoindata Errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Avoindata Errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cea150b91a7ace1e536d55a50210ebed?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Graphql errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Graphql errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Graphql errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cea150b91a7ace1e536d55a50210ebed?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Train-history errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "train-history"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Train-history errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Train-history errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/cea150b91a7ace1e536d55a50210ebed?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Avoindata OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Avoindata OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Avoindata OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Infra-api OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "infra-api"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Infra-api OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Infra-api OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Graphql OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Graphql OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Graphql OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Train-history OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Train-history OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Train-history OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/f64be232c96cd88b3fe8f3d2e59f6198?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL TST Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL TST Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: RAIL TST Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/266c9199b73fc3bf9b866e9ddb90780d?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Avoindata-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Avoindata-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 5000 && ctx.results[0].hits.total.value <= 150000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Avoindata-updater active should be between 5000 and 150000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD History-updater active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "history-updater"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD History-updater active",
        "condition": "!(ctx.results[0].hits.total.value >= 50 && ctx.results[0].hits.total.value <= 500)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD History-updater active should be between 50 and 500, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD RUNBOOK-Y5 - AvoindataUpdater reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started DatabaseUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD RUNBOOK-Y5 - AvoindataUpdater reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD RUNBOOK-Y5 - AvoindataUpdater reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD RUNBOOK-Y5 - AvoindataUpdater reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started ServerApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD RUNBOOK-Y5 - AvoindataUpdater reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD RUNBOOK-Y5 - AvoindataUpdater reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD RUNBOOK-Y5 - Etj2-Api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started Etj2APIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD RUNBOOK-Y5 - Etj2-Api reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD RUNBOOK-Y5 - Etj2-Api reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD RUNBOOK-Y5 - Infra-api reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started InfraAPIApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD RUNBOOK-Y5 - Infra-api reboots",
        "condition": "ctx.results[0].hits.total.value > 6",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD RUNBOOK-Y5 - Infra-api reboots {{ctx.results.0.hits.total.value}} should not be more than 6",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD RUNBOOK-Y5 - TrainHistoryBackendApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryBackendApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD RUNBOOK-Y5 - TrainHistoryBackendApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD RUNBOOK-Y5 - TrainHistoryBackendApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD RUNBOOK-Y5 - TrainHistoryUpdaterApplication reboots",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "message": {
                  "query": "Started TrainHistoryUpdaterApplication"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD RUNBOOK-Y5 - TrainHistoryUpdaterApplication reboots",
        "condition": "ctx.results[0].hits.total.value > 3",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD RUNBOOK-Y5 - TrainHistoryUpdaterApplication reboots {{ctx.results.0.hits.total.value}} should not be more than 3",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD RUNBOOK-R4 - Illegal mix of collations",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "multi_match": {
                "query": "mix of collations",
                "fields": [
                  "stack_trace",
                  "dump_log"
                ],
                "type": "phrase"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD RUNBOOK-R4 - Illegal mix of collations",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD RUNBOOK-R4 - Illegal mix of collations {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Avoindata Errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Avoindata Errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Avoindata Errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/b04e3ee091dde8e82bc72bb99fac5379?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Graphql errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Graphql errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Graphql errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/b04e3ee091dde8e82bc72bb99fac5379?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Train-history errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "train-history"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "logger_name": {
                  "query": "PendingConnectionDebugger"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Train-history errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Train-history errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/b04e3ee091dde8e82bc72bb99fac5379?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Avoindata OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "avoindata"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Avoindata OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Avoindata OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Infra-api OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "infra-api"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Infra-api OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Infra-api OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Graphql OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Graphql OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Graphql OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Train-history OutOfMemory",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "exists": {
                "field": "thread_name"
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "OutOfMemory"
                }
              }
            },
            {
              "match_phrase": {
                "@log_stream": {
                  "query": "graphql"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Train-history OutOfMemory",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Train-history OutOfMemory {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.logger_name}} {{ctx.results.0.hits.hits.0._source.message}} in {{ctx.results.0.hits.hits.0._source.app}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Lambda errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Lambda errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Lambda errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/4b61aad16aa801966eed2fec72477fa6?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Lambda timeouts",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "task timed out"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Lambda timeouts",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Lambda timeouts {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.@log_group}}",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "RAIL PRD Lambda memory usage over 95%",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "rail"
                }
              }
            },
            {
              "match_phrase": {
                "@log_group": {
                  "query": "lambda"
                }
              }
            },
            {
              "match_phrase": {
                "type": {
                  "query": "platform.report"
                }
              }
            },
            {
              "script": {
                "script": "((100.0*doc['record.metrics.maxMemoryUsedMB'].value)/doc['record.metrics.memorySizeMB'].value) > 95"
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "RAIL PRD Lambda memory usage over 95%",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: RAIL PRD Lambda memory usage over 95% {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "{{ctx.results.0.hits.hits.0._source.@timestamp}} {{ctx.results.0.hits.hits.0._source.method}} {{ctx.results.0.hits.hits.0._source.message}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/goto/443db667f3890e1332a069c72aac0df2?security_tenant=FintrafficDigitraffic|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST ROAD RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "tie-test.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT TST ROAD RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 20 && ctx.results[0].hits.total.value <= 100000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST ROAD RUNBOOK-C1 - Cloudfront active should be between 20 and 100000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST MARINE RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "meri-test.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT TST MARINE RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 5 && ctx.results[0].hits.total.value <= 100000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST MARINE RUNBOOK-C1 - Cloudfront active should be between 5 and 100000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST RAIL RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "rata-beta.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT TST RAIL RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 100 && ctx.results[0].hits.total.value <= 100000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST RAIL RUNBOOK-C1 - Cloudfront active should be between 100 and 100000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST WEATHERCAM RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "weathercam-test.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT TST WEATHERCAM RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 0 && ctx.results[0].hits.total.value <= 10000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST WEATHERCAM RUNBOOK-C1 - Cloudfront active should be between 0 and 10000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST ROAD RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "tie-test.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST ROAD RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 0 && ctx.results[0].aggregations.sum_bytes.value <= 400)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST ROAD RUNBOOK-C2 - Cloudfront data transfer should be between 0 MB and 400 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST WEATHERCAM RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "weathercam-test.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST WEATHERCAM RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 0 && ctx.results[0].aggregations.sum_bytes.value <= 100)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST WEATHERCAM RUNBOOK-C2 - Cloudfront data transfer should be between 0 MB and 100 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST PORTACTIVITY RUNBOOK-C1 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "portactivity-test.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST PORTACTIVITY RUNBOOK-C1 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 0 && ctx.results[0].aggregations.sum_bytes.value <= 10)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST PORTACTIVITY RUNBOOK-C1 - Cloudfront data transfer should be between 0 MB and 10 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST PARKING RUNBOOK-C1 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "parking-test.fintraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST PARKING RUNBOOK-C1 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 2 && ctx.results[0].aggregations.sum_bytes.value <= 100)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST PARKING RUNBOOK-C1 - Cloudfront data transfer should be between 2 MB and 100 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST ROAD RUNBOOK-C2 - integration Cloudfront data transfer IN",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "tie-test.integration.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_requestBytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST ROAD RUNBOOK-C2 - integration Cloudfront data transfer IN",
        "condition": "!(ctx.results[0].aggregations.sum_requestBytes.value >= 0 && ctx.results[0].aggregations.sum_requestBytes.value <= 10)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST ROAD RUNBOOK-C2 - integration Cloudfront data transfer IN should be between 0 MB and 10 MB, was {{ctx.results.0.aggregations.sum_requestBytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST MARINE RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "meri-test.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST MARINE RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 0 && ctx.results[0].aggregations.sum_bytes.value <= 5000)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST MARINE RUNBOOK-C2 - Cloudfront data transfer should be between 0 MB and 5000 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST MARINE RUNBOOK-C2 - integration Cloudfront data transfer IN",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "meri-test.integration.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_requestBytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST MARINE RUNBOOK-C2 - integration Cloudfront data transfer IN",
        "condition": "!(ctx.results[0].aggregations.sum_requestBytes.value >= 0 && ctx.results[0].aggregations.sum_requestBytes.value <= 10)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST MARINE RUNBOOK-C2 - integration Cloudfront data transfer IN should be between 0 MB and 10 MB, was {{ctx.results.0.aggregations.sum_requestBytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST RAIL RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "rata-beta.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST RAIL RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 0 && ctx.results[0].aggregations.sum_bytes.value <= 30)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST RAIL RUNBOOK-C2 - Cloudfront data transfer should be between 0 MB and 30 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT TST RAIL RUNBOOK-C2 - integration Cloudfront data transfer IN",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "rata-beta.integration.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_requestBytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT TST RAIL RUNBOOK-C2 - integration Cloudfront data transfer IN",
        "condition": "!(ctx.results[0].aggregations.sum_requestBytes.value >= 0 && ctx.results[0].aggregations.sum_requestBytes.value <= 15)",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CLOUDFRONT TST RAIL RUNBOOK-C2 - integration Cloudfront data transfer IN should be between 0 MB and 15 MB, was {{ctx.results.0.aggregations.sum_requestBytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD ROAD RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "tie.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT PRD ROAD RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 20000 && ctx.results[0].hits.total.value <= 1000000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD ROAD RUNBOOK-C1 - Cloudfront active should be between 20000 and 1000000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD MARINE RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "meri.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT PRD MARINE RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 10000 && ctx.results[0].hits.total.value <= 500000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD MARINE RUNBOOK-C1 - Cloudfront active should be between 10000 and 500000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD RAIL RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "rata.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT PRD RAIL RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 10000 && ctx.results[0].hits.total.value <= 750000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD RAIL RUNBOOK-C1 - Cloudfront active should be between 10000 and 750000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD WEATHERCAM RUNBOOK-C1 - Cloudfront active",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "weathercam.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CLOUDFRONT PRD WEATHERCAM RUNBOOK-C1 - Cloudfront active",
        "condition": "!(ctx.results[0].hits.total.value >= 200000 && ctx.results[0].hits.total.value <= 1000000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD WEATHERCAM RUNBOOK-C1 - Cloudfront active should be between 200000 and 1000000, was {{ctx.results.0.hits.total.value}}",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD ROAD RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "tie.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD ROAD RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 2000 && ctx.results[0].aggregations.sum_bytes.value <= 11000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD ROAD RUNBOOK-C2 - Cloudfront data transfer should be between 2000 MB and 11000 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD WEATHERCAM RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "weathercam.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD WEATHERCAM RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 40000 && ctx.results[0].aggregations.sum_bytes.value <= 90000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD WEATHERCAM RUNBOOK-C2 - Cloudfront data transfer should be between 40000 MB and 90000 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD PORTACTIVITY RUNBOOK-C1 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "portactivity.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD PORTACTIVITY RUNBOOK-C1 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 5 && ctx.results[0].aggregations.sum_bytes.value <= 30)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD PORTACTIVITY RUNBOOK-C1 - Cloudfront data transfer should be between 5 MB and 30 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD PARKING RUNBOOK-C1 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "parking.fintraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD PARKING RUNBOOK-C1 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 30 && ctx.results[0].aggregations.sum_bytes.value <= 200)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD PARKING RUNBOOK-C1 - Cloudfront data transfer should be between 30 MB and 200 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD ROAD RUNBOOK-C2 - integration Cloudfront data transfer IN",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "tie.integration.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_requestBytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD ROAD RUNBOOK-C2 - integration Cloudfront data transfer IN",
        "condition": "!(ctx.results[0].aggregations.sum_requestBytes.value >= 0 && ctx.results[0].aggregations.sum_requestBytes.value <= 10)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD ROAD RUNBOOK-C2 - integration Cloudfront data transfer IN should be between 0 MB and 10 MB, was {{ctx.results.0.aggregations.sum_requestBytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD MARINE RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "meri.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD MARINE RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 1000 && ctx.results[0].aggregations.sum_bytes.value <= 25000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD MARINE RUNBOOK-C2 - Cloudfront data transfer should be between 1000 MB and 25000 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD MARINE RUNBOOK-C2 - integration Cloudfront data transfer IN",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "meri.integration.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_requestBytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD MARINE RUNBOOK-C2 - integration Cloudfront data transfer IN",
        "condition": "!(ctx.results[0].aggregations.sum_requestBytes.value >= 0 && ctx.results[0].aggregations.sum_requestBytes.value <= 10)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD MARINE RUNBOOK-C2 - integration Cloudfront data transfer IN should be between 0 MB and 10 MB, was {{ctx.results.0.aggregations.sum_requestBytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD RAIL RUNBOOK-C2 - Cloudfront data transfer",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "rata.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_bytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD RAIL RUNBOOK-C2 - Cloudfront data transfer",
        "condition": "!(ctx.results[0].aggregations.sum_bytes.value >= 300 && ctx.results[0].aggregations.sum_bytes.value <= 30000)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD RAIL RUNBOOK-C2 - Cloudfront data transfer should be between 300 MB and 30000 MB, was {{ctx.results.0.aggregations.sum_bytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "CLOUDFRONT PRD RAIL RUNBOOK-C2 - integration Cloudfront data transfer IN",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-60m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "httpHost": {
                  "query": "rata.integration.digitraffic.fi"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "sum_requestBytes": {
        "scripted_metric": {
          "init_script": "state.responses = ['total': 0L]",
          "map_script": "state.responses.total+= doc['bytes'].value",
          "combine_script": "state.responses",
          "reduce_script": "def sum = ['total': 0L]; for (responses in states) { sum.total += responses['total']; } return (sum.total / (1000*1000));"
        }
      }
    },
    "triggers": [
      {
        "name": "CLOUDFRONT PRD RAIL RUNBOOK-C2 - integration Cloudfront data transfer IN",
        "condition": "!(ctx.results[0].aggregations.sum_requestBytes.value >= 0 && ctx.results[0].aggregations.sum_requestBytes.value <= 15)",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CLOUDFRONT PRD RAIL RUNBOOK-C2 - integration Cloudfront data transfer IN should be between 0 MB and 15 MB, was {{ctx.results.0.aggregations.sum_requestBytes.value}} MB",
            "message": "",
            "throttleMinutes": 120
          }
        ]
      }
    ]
  },
  {
    "name": "PARKING TST RUNBOOK-L1 - Liipi user's organization not found",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "parking"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "Could not find an operator"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "PARKING TST RUNBOOK-L1 - Liipi user's organization not found",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: PARKING TST RUNBOOK-L1 - Liipi user's organization not found {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "PARKING PRD RUNBOOK-L1 - Liipi user's organization not found",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "parking"
                }
              }
            },
            {
              "match_phrase": {
                "log_line": {
                  "query": "Could not find an operator"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "PARKING PRD RUNBOOK-L1 - Liipi user's organization not found",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: PARKING PRD RUNBOOK-L1 - Liipi user's organization not found {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "STATUS TST Errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "status"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "STATUS TST Errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: STATUS TST Errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "STATUS PRD Errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "status"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "STATUS PRD Errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: STATUS PRD Errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG TST Errors",
    "cron": "0 8 * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-1440m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "filename": {
        "terms": {
          "field": "filename.keyword"
        },
        "aggregations": {
          "fn_name": {
            "terms": {
              "field": "funcName.keyword"
            },
            "aggregations": {
              "messages": {
                "terms": {
                  "field": "message"
                }
              }
            }
          }
        }
      }
    },
    "triggers": [
      {
        "name": "CATALOG TST Errors",
        "condition": "true",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CATALOG TST Errors",
            "message": "*{{ctx.results.0.hits.total.value}}* Errors in total\n\nBreakdown of the errors\n---\n{{#ctx.results.0.aggregations.filename.buckets}}\n*{{key}}*\n{{#fn_name.buckets}}\n`{{key}}` function call emitted {{doc_count}} errors.\nA sample error (there might be different kinds of errors as well)\n```\n{{messages.buckets.0.key}}\n```\n{{/fn_name.buckets}}\n{{/ctx.results.0.aggregations.filename.buckets}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/app/dashboards?security_tenant=FintrafficDigitraffic#/view/77a64560-72c3-11f0-927a-3bf9d46f4557?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-1d,to:now))|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG TST RUNBOOK-D1 - Unfinished Sign Ins",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": "now-5m"
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            },
            {
              "match_phrase": {
                "alert.id": {
                  "query": "AUTH_FLOW"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "correlation_ids": {
        "terms": {
          "field": "alert.correlation_id.keyword"
        },
        "aggregations": {
          "unfinished_signins": {
            "bucket_selector": {
              "buckets_path": {
                "count": "_count"
              },
              "script": "params.count < 2"
            }
          }
        }
      }
    },
    "triggers": [
      {
        "name": "CATALOG TST RUNBOOK-D1 - Unfinished Sign Ins",
        "condition": "ctx.results[0].aggregations.correlation_ids.buckets.length > 2",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CATALOG TST RUNBOOK-D1 - Unfinished Sign Ins {{ctx.results.0.aggregations.correlation_ids.buckets.length}} should not be more than 2",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG PRD Errors",
    "cron": "0 8 * * *",
    "indices": [
      "ft-digitraffic-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-1440m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {
      "filename": {
        "terms": {
          "field": "filename.keyword"
        },
        "aggregations": {
          "fn_name": {
            "terms": {
              "field": "funcName.keyword"
            },
            "aggregations": {
              "messages": {
                "terms": {
                  "field": "message"
                }
              }
            }
          }
        }
      }
    },
    "triggers": [
      {
        "name": "CATALOG PRD Errors",
        "condition": "true",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: CATALOG PRD Errors",
            "message": "*{{ctx.results.0.hits.total.value}}* Errors in total\n\nBreakdown of the errors\n---\n{{#ctx.results.0.aggregations.filename.buckets}}\n*{{key}}*\n{{#fn_name.buckets}}\n`{{key}}` function call emitted {{doc_count}} errors.\nA sample error (there might be different kinds of errors as well)\n```\n{{messages.buckets.0.key}}\n```\n{{/fn_name.buckets}}\n{{/ctx.results.0.aggregations.filename.buckets}} <https://os.fintraffic-centralized-logging-prd.aws.fintraffic.cloud/_dashboards/app/dashboards?security_tenant=FintrafficDigitraffic#/view/525f74f0-7379-11f0-b0d2-67828a0213d5?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-1d,to:now))|Opensearch>",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG TST RUNBOOK-D2 - Error when creating a new dataset",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            },
            {
              "match_phrase": {
                "request": {
                  "query": "/dataset/new"
                }
              }
            }
          ],
          "must_not": [
            {
              "bool": {
                "should": [
                  {
                    "match_phrase": {
                      "httpStatusCode": {
                        "query": "200"
                      }
                    }
                  },
                  {
                    "match_phrase": {
                      "httpStatusCode": {
                        "query": "403"
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CATALOG TST RUNBOOK-D2 - Error when creating a new dataset",
        "condition": "ctx.results[0].hits.total.value > 2",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CATALOG TST RUNBOOK-D2 - Error when creating a new dataset {{ctx.results.0.hits.total.value}} should not be more than 2",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG TST RUNBOOK-D2 - Error when creating a new distribution",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            },
            {
              "wildcard": {
                "request.keyword": {
                  "value": "/dataset/*/resource/new"
                }
              }
            }
          ],
          "must_not": [
            {
              "bool": {
                "should": [
                  {
                    "match_phrase": {
                      "httpStatusCode": {
                        "query": "200"
                      }
                    }
                  },
                  {
                    "match_phrase": {
                      "httpStatusCode": {
                        "query": "403"
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CATALOG TST RUNBOOK-D2 - Error when creating a new distribution",
        "condition": "ctx.results[0].hits.total.value > 2",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CATALOG TST RUNBOOK-D2 - Error when creating a new distribution {{ctx.results.0.hits.total.value}} should not be more than 2",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG TST RUNBOOK-D3 - Error when fetching catalog MobilityDCAT-AP metadata",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            },
            {
              "wildcard": {
                "request.keyword": {
                  "value": "/catalog.*"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "httpStatusCode": {
                  "query": "200"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CATALOG TST RUNBOOK-D3 - Error when fetching catalog MobilityDCAT-AP metadata",
        "condition": "ctx.results[0].hits.total.value > 2",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CATALOG TST RUNBOOK-D3 - Error when fetching catalog MobilityDCAT-AP metadata {{ctx.results.0.hits.total.value}} should not be more than 2",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG TST RUNBOOK-D3 - Error when fetching dataset MobilityDCAT-AP metadata",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            },
            {
              "regexp": {
                "request.keyword": {
                  "value": "/dataset/[a-zA-Z0-9-]+\\..{1,3}"
                }
              }
            }
          ],
          "must_not": [
            {
              "match_phrase": {
                "httpStatusCode": {
                  "query": "200"
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CATALOG TST RUNBOOK-D3 - Error when fetching dataset MobilityDCAT-AP metadata",
        "condition": "ctx.results[0].hits.total.value > 2",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CATALOG TST RUNBOOK-D3 - Error when fetching dataset MobilityDCAT-AP metadata {{ctx.results.0.hits.total.value}} should not be more than 2",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "CATALOG TST RUNBOOK-D4 - Catalog might be down",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-access-cdn*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "accountName": {
                  "query": "catalog"
                }
              }
            }
          ],
          "must_not": [
            {
              "range": {
                "httpStatusCode": {
                  "from": 500,
                  "to": 599
                }
              }
            }
          ]
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "CATALOG TST RUNBOOK-D4 - Catalog might be down",
        "condition": "ctx.results[0].hits.total.value > 100",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: CATALOG TST RUNBOOK-D4 - Catalog might be down {{ctx.results.0.hits.total.value}} should not be more than 100",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TIS TST Errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-tis-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "tst"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "TIS TST Errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "NnNtfocBGCKZ_YfaLa6j",
            "subject": ":red_circle: TIS TST Errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  },
  {
    "name": "TIS PRD Errors",
    "cron": "2/5 * * * *",
    "indices": [
      "ft-digitraffic-tis-cwl*"
    ],
    "query": {
      "size": 1,
      "query": {
        "bool": {
          "must": [
            {
              "range": {
                "@timestamp": {
                  "from": "now-15m",
                  "to": null
                }
              }
            },
            {
              "match_phrase": {
                "env": {
                  "query": "prd"
                }
              }
            },
            {
              "match_phrase": {
                "level": {
                  "query": "ERROR"
                }
              }
            }
          ],
          "must_not": []
        }
      },
      "sort": [
        {
          "@timestamp": {
            "order": "desc"
          }
        }
      ]
    },
    "aggregations": {},
    "triggers": [
      {
        "name": "TIS PRD Errors",
        "condition": "ctx.results[0].hits.total.value > 0",
        "actions": [
          {
            "destination": "fzj5-ocBTeP6dVoCrXqR",
            "subject": ":red_circle: TIS PRD Errors {{ctx.results.0.hits.total.value}} should not be more than 0",
            "message": "",
            "throttleMinutes": 30
          }
        ]
      }
    ]
  }
]
